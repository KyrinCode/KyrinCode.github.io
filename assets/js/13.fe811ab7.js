(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{562:function(t,r,a){t.exports=a.p+"assets/img/Ngrok.d34cf232.png"},598:function(t,r,a){"use strict";a.r(r);var s=a(4),e=Object(s.a)({},(function(){var t=this,r=t.$createElement,s=t._self._c||r;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("介绍一个开发阶段调试时很方便的内网穿透工具 Ngrok")]),t._v(" "),s("h2",{attrs:{id:"ngrok"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ngrok"}},[t._v("#")]),t._v(" Ngrok")]),t._v(" "),s("p",[t._v("在写一个 "),s("a",{attrs:{href:"https://github.com/KyrinCode/face_mark_v2",target:"_blank",rel:"noopener noreferrer"}},[t._v("颜值检测 AI Beauty 网站"),s("OutboundLink")],1),t._v(" 时，想让小伙伴们也能参与帮我测试，怎么办呢，于是查资料找到了这个内网穿透工具。")]),t._v(" "),s("p",[t._v("使用 "),s("a",{attrs:{href:"https://ngrok.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Ngrok"),s("OutboundLink")],1),t._v(" 内网穿透工具可以将本地 Web 程序映射到公网。")]),t._v(" "),s("p",[t._v("可以针对集中需求：让朋友可以访问到你本地运行的程序、在本地测试各类服务、有一台本地的电脑专门作为一台服务器来运行网站。")]),t._v(" "),s("p",[t._v("借助内网穿透/映射工具，公网上的朋友可以通过被分配的域名 A 映射访问到运行在你的笔记本上的程序。在本地运行程序，建立映射后，其他用户访问 A 网址时，内网穿透工具就会把请求转发到你的笔记本中，取回响应后再返回给用户。具体流程如下所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(562),alt:"Ngrok"}})]),t._v(" "),s("h2",{attrs:{id:"安装运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装运行"}},[t._v("#")]),t._v(" 安装运行")]),t._v(" "),s("p",[t._v("在 "),s("a",{attrs:{href:"https://ngrok.com/download",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网"),s("OutboundLink")],1),t._v(" 下载对应的压缩包，解压到 /usr/local/bin/ 中。")]),t._v(" "),s("p",[t._v("注册账户后（可关联 GitHub）获得免费用户的 "),s("a",{attrs:{href:"https://dashboard.ngrok.com/auth",target:"_blank",rel:"noopener noreferrer"}},[t._v("令牌"),s("OutboundLink")],1),t._v("，未注册账户每个会话只会维持8小时，过期后你需要重新启动。")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 帮助")]),t._v("\n$ ngrok "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("help")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 令牌")]),t._v("\n$ ./ngrok authtoken "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("token"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 建立映射/HTTP隧道")]),t._v("\n$ ngrok http "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("每次建立映射，Ngrok 都会分配一个随机子域的网址，通过此域名即可在公网访问本地 Web 程序。")]),t._v(" "),s("h2",{attrs:{id:"trick"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#trick"}},[t._v("#")]),t._v(" Trick")]),t._v(" "),s("p",[t._v('发现通过内网穿透后，访客的地址都变成本地的 ::1，所以针对这个问题，找到了解决办法：在请求头 headers 的 "x-forwarded-for" 字段是访客的真实 ip。')]),t._v(" "),s("p",[t._v("举例在 flask 中用如下代码即可获取真实ip。")]),t._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("ip "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"x-forwarded-for"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])}),[],!1,null,null,null);r.default=e.exports}}]);